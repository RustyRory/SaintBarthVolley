name: V√©rification de la pr√©sence d'une issue

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  check-ticket:
    runs-on: ubuntu-latest
    steps:
      - name: V√©rifier la r√©f√©rence √† une issue
        shell: bash
        run: |
          BRANCHE="${{ github.head_ref }}"
          TITRE="${{ github.event.pull_request.title }}"

          echo "Nom de branche : $BRANCHE"
          echo "Titre de PR : $TITRE"

          echo "$TITRE" | grep -q '#[0-9]\+' && FOUND="true" || FOUND="false"
          if [ "$FOUND" = "true" ]; then
            echo "‚úÖ Issue r√©f√©renc√©e dans le titre de la PR"
          else
            echo "$BRANCHE" | grep -q '[0-9]\+-' && FOUND="true" || FOUND="false"
            if [ "$FOUND" = "true" ]; then
              echo "‚úÖ Issue r√©f√©renc√©e dans le nom de la branche"
            else
              echo "‚ùå Aucune r√©f√©rence √† une issue d√©tect√©e"
              echo "üí° Comment corriger :"
              echo "  - Ajouter #<num√©ro> dans le titre de la PR"
              echo "  - Ou inclure le num√©ro de l‚Äôissue dans le nom de la branche (ex: feature/123-login-page)"
              exit 1
            fi
          fi
