name: 'Vérification de la référence au ticket dans la PR'

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-ticket:
    runs-on: ubuntu-latest
    steps:
    - name: 'Vérifier le titre et la branche de la PR pour une référence au ticket'
      run: |
        set -e

        PR_TITLE="${{ github.event.pull_request.title }}"
        BRANCH_NAME="${{ github.head_ref }}"

        echo "Titre de PR : $PR_TITLE"
        echo "Nom de branche : $BRANCH_NAME"

        if [[ "$PR_TITLE" =~ #[0-9]+ ]]; then
          echo "✅ Le titre de la PR contient une référence au ticket."
          exit 0
        fi

        if [[ "$BRANCH_NAME" =~ [0-9]+ ]]; then
          echo "✅ Le nom de la branche contient un numéro de ticket."
          exit 0
        fi

        echo "❌ Aucune référence au ticket trouvée !"
        echo "Incluez une référence dans le titre de la PR (#<num>) ou le nom de la branche."
        exit 1
