name: 'Check Project Structure'

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-structure:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout PR'
        uses: actions/checkout@v3
        with:
          fetch-depth: 1

      - name: 'Verify project structure'
        run: |
          echo "üîç V√©rification de la structure du projet"

          INVALID=false

          # Fichiers racine obligatoires
          ROOT_FILES=("README.md" "CONTRIBUTING.md" "INSTALL.md" "LICENSE")
          for FILE in "${ROOT_FILES[@]}"; do
            if [ ! -f "$FILE" ]; then
              echo "‚ùå Fichier racine manquant : $FILE"
              INVALID=true
            else
              echo "‚úÖ Fichier trouv√© : $FILE"
            fi
          done

          # Dossiers obligatoires
          DIRS=("app/frontend" "app/backend")
          for DIR in "${DIRS[@]}"; do
            if [ ! -d "$DIR" ]; then
              echo "‚ùå Dossier manquant : $DIR"
              INVALID=true
            else
              echo "‚úÖ Dossier trouv√© : $DIR"
            fi
          done

          # V√©rification interne frontend
          if [ -d "app/frontend" ]; then
            if [ ! -f "app/frontend/package.json" ]; then
              echo "‚ùå Fichier manquant dans frontend : package.json"
              INVALID=true
            fi
            if [ ! -f "app/frontend/.env.example" ]; then
              echo "‚ùå Fichier manquant dans frontend : .env.example"
              INVALID=true
            fi
          fi

          # V√©rification interne backend
          if [ -d "app/backend" ]; then
            if [ ! -f "app/backend/package.json" ]; then
              echo "‚ùå Fichier manquant dans backend : package.json"
              INVALID=true
            fi
            if [ ! -f "app/backend/.env.example" ]; then
              echo "‚ùå Fichier manquant dans backend : .env.example"
              INVALID=true
            fi
          fi

          # Blocage si structure incorrecte
          if [ "$INVALID" = true ]; then
            echo ""
            echo "‚ö†Ô∏è Structure du projet invalide. Veuillez ajouter les fichiers/dossiers manquants."
            exit 1
          else
            echo "‚úÖ Structure du projet OK"
          fi
